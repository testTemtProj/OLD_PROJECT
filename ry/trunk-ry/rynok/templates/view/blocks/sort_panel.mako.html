<ul class="sort">
    <li>Сортировать по:</li>
    <li><a href="${c.price_url}" <% if c.key == 'price': context.write('class="'+c.order+'"')  %> >цене</a></li>
    <li><a href="${c.popular_url}" <% if c.key == 'popular': context.write('class="'+c.order+'"')  %> >популярности</a></li>
    <li><a href="${c.rating_url}" <% if c.key == 'rating': context.write('class="'+c.order+'"')  %> >рейтингу</a></li>
    <li class="last"><span>Отображать:</span>
        <select class="custom" id="count-select">
<%
value = int(request.params.get('per_page', 10))
if value == 10:
    context.write('<option selected>10</option>')
else:
    context.write('<option>10</option>')

if value == 25:
    context.write('<option selected>25</option>')
else:
    context.write('<option>25</option>')

if value == 50:
    context.write('<option selected>50</option>')
else:
    context.write('<option>50</option>')

%>
        </select>
        <div class="clr"></div>
    </li>
</ul>
<script type="text/javascript">
$(document).ready(function(){
    $('#count-select').change(function(){
        var selected = $(this).find('option:selected').text();
        var current_url = '${url.current()+'?'+h.literal(request.query_string)}';
        var search = current_url.search('per_page=');
        if(search == -1){
            var url = current_url+'&per_page='+selected;
        }
        else{
            var url = current_url.replace(new RegExp('per_page=[0-9]{2}'), 'per_page='+selected);
        }
        url = url.replace(/[0-9]+\?/, '1?');
        window.document.location = url;
    });

});
</script>